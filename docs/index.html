<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Gestión de Inventario</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <style id="app-style">
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .loading {
      position: relative;
      pointer-events: none;
    }
    .loading:after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 4px;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(-20px);
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    .toast-success {
      background-color: #48bb78;
      color: white;
    }
    .toast-error {
      background-color: #f56565;
      color: white;
    }
    .table-container {
      overflow-x: auto;
    }
    .image-preview {
      max-width: 100px;
      max-height: 100px;
      object-fit: contain;
    }
    .thumbnail {
      width: 50px;
      height: 50px;
      object-fit: cover;
    }
    @media (max-width: 640px) {
      .responsive-table {
        display: block;
        width: 100%;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-6">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">Sistema de Gestión de Inventario</h1>
      <p class="text-gray-600">Control de accesorios y entregas</p>
    </header>

    <!-- Tabs Navigation -->
    <div class="border-b border-gray-200 mb-6">
      <ul class="flex flex-wrap -mb-px" id="tabs">
        <li class="mr-2">
          <a href="javascript:void(0)" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 active" data-tab="entrada">
            <i class="fas fa-box-open mr-2"></i>Entrada de Inventario
          </a>
        </li>
        <li class="mr-2">
          <a href="javascript:void(0)" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" data-tab="stock">
            <i class="fas fa-warehouse mr-2"></i>Stock
          </a>
        </li>
        <li>
          <a href="javascript:void(0)" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" data-tab="entrega">
            <i class="fas fa-handshake mr-2"></i>Entrega de Accesorios
          </a>
        </li>
      </ul>
    </div>

    <!-- Tab Content -->
    <div id="tab-contents">
      <!-- Entrada de Inventario -->
      <div id="entrada-tab" class="tab-content active">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-semibold mb-6">Registro de Entrada de Inventario</h2>
          
          <form id="entrada-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label for="numero-parte" class="block text-sm font-medium text-gray-700 mb-1">Número de Parte *</label>
              <input type="text" id="numero-parte" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div class="form-group">
              <label for="fecha-entrada" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Entrada *</label>
              <input type="date" id="fecha-entrada" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div class="form-group md:col-span-2">
              <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-1">Descripción del accesorio *</label>
              <textarea id="descripcion" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" required></textarea>
            </div>
            
            <div class="form-group">
              <label for="ubicacion" class="block text-sm font-medium text-gray-700 mb-1">Ubicación (jaula) *</label>
              <select id="ubicacion" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <option value="Jaula">Jaula</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="cantidad" class="block text-sm font-medium text-gray-700 mb-1">Cantidad ingresada *</label>
              <input type="number" id="cantidad" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div class="form-group md:col-span-2">
              <label for="imagenes" class="block text-sm font-medium text-gray-700 mb-1">Imágenes</label>
              <input type="file" id="imagenes" multiple accept="image/*" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              <div id="image-preview-container" class="mt-3 flex flex-wrap gap-2"></div>
            </div>
            
            <div class="md:col-span-2 mt-2">
              <button type="submit" id="guardar-entrada" class="w-full md:w-auto px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                <i class="fas fa-save mr-2"></i> Guardar
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Stock -->
      <div id="stock-tab" class="tab-content">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-semibold mb-6">Gestión de Stock</h2>
          
          <div class="mb-6 bg-gray-50 p-4 rounded-md">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div class="form-group">
                <label for="filtro-parte" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Número de Parte</label>
                <input type="text" id="filtro-parte" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              
              <div class="form-group">
                <label for="filtro-descripcion" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Descripción</label>
                <input type="text" id="filtro-descripcion" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              
              <div class="form-group">
                <label for="filtro-ubicacion" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Ubicación</label>
                <input type="text" id="filtro-ubicacion" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              
              <div class="form-group flex items-end">
                <button id="aplicar-filtros" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors mr-2">
                  <i class="fas fa-filter mr-1"></i> Filtrar
                </button>
                <button id="limpiar-filtros" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-colors">
                  <i class="fas fa-broom mr-1"></i> Limpiar
                </button>
              </div>
            </div>
          </div>
          
          <div class="flex justify-end mb-4 gap-2">
            <button id="exportar-excel" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors">
              <i class="fas fa-file-excel mr-1"></i> Exportar a Excel
            </button>
            <button id="exportar-pdf" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors">
              <i class="fas fa-file-pdf mr-1"></i> Exportar a PDF
            </button>
          </div>
          
          <div class="table-container responsive-table">
            <table id="stock-table" class="min-w-full bg-white border border-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="py-2 px-4 border-b text-left">Número de Parte</th>
                  <th class="py-2 px-4 border-b text-left">Descripción</th>
                  <th class="py-2 px-4 border-b text-left">Ubicación</th>
                  <th class="py-2 px-4 border-b text-right">Cantidad Disponible</th>
                  <th class="py-2 px-4 border-b text-center">Imagen</th>
                </tr>
              </thead>
              <tbody id="stock-items">
                <!-- Se llenará dinámicamente -->
                <tr class="hover:bg-gray-50">
                  <td colspan="5" class="py-4 px-4 text-center text-gray-500">Cargando inventario...</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="mt-4 flex justify-between items-center">
            <div class="text-sm text-gray-500">
              Mostrando <span id="items-showing">0</span> de <span id="items-total">0</span> elementos
            </div>
            <div class="flex space-x-2">
              <button id="prev-page" class="px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-left"></i>
              </button>
              <span id="page-info" class="px-3 py-1">Página <span id="current-page">1</span> de <span id="total-pages">1</span></span>
              <button id="next-page" class="px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Entrega de Accesorios -->
      <div id="entrega-tab" class="tab-content">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-xl font-semibold mb-6">Registro de Entrega de Accesorios</h2>
          
          <form id="entrega-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="form-group">
              <label for="accesorio-id" class="block text-sm font-medium text-gray-700 mb-1">ID de Accesorio *</label>
              <select id="accesorio-id" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <option value="">Seleccione un accesorio</option>
                <!-- Se llenará dinámicamente -->
              </select>
            </div>
            
            <div class="form-group">
              <label for="tipo-accesorio" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Accesorio *</label>
              <select id="tipo-accesorio" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <option value="">Seleccione un tipo</option>
                <option value="bolsa">Bolsa</option>
                <option value="gorra">Gorra</option>
                <option value="guantes">Guantes</option>
                <option value="pelota">Pelota</option>
                <option value="accesorio-pequeno">Accesorio pequeño</option>
                <option value="kit">Kit</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="cantidad-salida" class="block text-sm font-medium text-gray-700 mb-1">Cantidad *</label>
              <input type="number" id="cantidad-salida" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div class="form-group">
              <label for="celda-destino" class="block text-sm font-medium text-gray-700 mb-1">Celda de destino *</label>
              <select id="celda-destino" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <option value="">Seleccione una celda</option>
                <option value="Celda 10">Celda 10</option>
                <option value="Celda 11">Celda 11</option>
                <option value="Celda 15">Celda 15</option>
                <option value="Celda 16">Celda 16</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="supervisor" class="block text-sm font-medium text-gray-700 mb-1">Supervisor *</label>
              <select id="supervisor" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <option value="">Seleccione un supervisor</option>
                <option value="Juan Pérez">Juan Pérez</option>
                <option value="María García">María García</option>
                <option value="Carlos López">Carlos López</option>
                <option value="Ana Rodríguez">Ana Rodríguez</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="persona-entrega" class="block text-sm font-medium text-gray-700 mb-1">Persona que entrega *</label>
              <select id="persona-entrega" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                <option value="">Seleccione una persona</option>
                <option value="Yodeli">Yodeli</option>
                <option value="Denise">Denise</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="fecha-salida" class="block text-sm font-medium text-gray-700 mb-1">Fecha de Salida *</label>
              <input type="date" id="fecha-salida" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            </div>
            
            <div class="md:col-span-3">
              <button type="submit" id="registrar-salida" class="w-full md:w-auto px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors">
                <i class="fas fa-paper-plane mr-2"></i> Registrar Salida
              </button>
            </div>
          </form>
          
          <hr class="my-8">
          
          <h3 class="text-lg font-semibold mb-4">Historial de Salidas</h3>
          
          <div class="mb-6 bg-gray-50 p-4 rounded-md">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div class="form-group">
                <label for="filtro-fecha" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Fecha</label>
                <input type="date" id="filtro-fecha" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              
              <div class="form-group">
                <label for="filtro-supervisor" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Supervisor</label>
                <select id="filtro-supervisor" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">Todos los supervisores</option>
                  <option value="Juan Pérez">Juan Pérez</option>
                  <option value="María García">María García</option>
                  <option value="Carlos López">Carlos López</option>
                  <option value="Ana Rodríguez">Ana Rodríguez</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="filtro-celda" class="block text-sm font-medium text-gray-700 mb-1">Filtrar por Celda</label>
                <input type="text" id="filtro-celda" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              
              <div class="form-group flex items-end">
                <button id="aplicar-filtros-salidas" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 transition-colors mr-2">
                  <i class="fas fa-filter mr-1"></i> Filtrar
                </button>
                <button id="limpiar-filtros-salidas" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-colors">
                  <i class="fas fa-broom mr-1"></i> Limpiar
                </button>
              </div>
            </div>
          </div>
          
          <div class="flex justify-end mb-4 gap-2">
            <button id="exportar-excel-salidas" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors">
              <i class="fas fa-file-excel mr-1"></i> Exportar a Excel
            </button>
            <button id="exportar-pdf-salidas" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors">
              <i class="fas fa-file-pdf mr-1"></i> Exportar a PDF
            </button>
          </div>
          
          <div class="table-container responsive-table">
            <table id="salidas-table" class="min-w-full bg-white border border-gray-200">
              <thead class="bg-gray-100">
                <tr>
                  <th class="py-2 px-4 border-b text-left">ID de Salida</th>
                  <th class="py-2 px-4 border-b text-left">ID de Accesorio</th>
                  <th class="py-2 px-4 border-b text-right">Cantidad</th>
                  <th class="py-2 px-4 border-b text-left">Fecha de Salida</th>
                  <th class="py-2 px-4 border-b text-left">Supervisor</th>
                  <th class="py-2 px-4 border-b text-left">Persona</th>
                  <th class="py-2 px-4 border-b text-center">Acciones</th>
                </tr>
              </thead>
              <tbody id="salidas-items">
                <!-- Se llenará dinámicamente -->
                <tr class="hover:bg-gray-50">
                  <td colspan="7" class="py-4 px-4 text-center text-gray-500">Cargando salidas...</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="mt-4 flex justify-between items-center">
            <div class="text-sm text-gray-500">
              Mostrando <span id="salidas-showing">0</span> de <span id="salidas-total">0</span> elementos
            </div>
            <div class="flex space-x-2">
              <button id="prev-page-salidas" class="px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-left"></i>
              </button>
              <span id="page-info-salidas" class="px-3 py-1">Página <span id="current-page-salidas">1</span> de <span id="total-pages-salidas">1</span></span>
              <button id="next-page-salidas" class="px-3 py-1 border border-gray-300 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notifications -->
  <div id="toast" class="toast">
    <span id="toast-message"></span>
  </div>

  <!-- Modal para editar salida -->
  <div id="modal-editar" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">Editar Salida</h3>
        <button id="cerrar-modal" class="text-gray-500 hover:text-gray-700 focus:outline-none">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="editar-salida-form" class="space-y-4">
        <input type="hidden" id="editar-id">
        <div class="form-group">
          <label for="editar-cantidad" class="block text-sm font-medium text-gray-700 mb-1">Cantidad</label>
          <input type="number" id="editar-cantidad" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
        
        <div class="form-group">
          <label for="editar-supervisor" class="block text-sm font-medium text-gray-700 mb-1">Supervisor</label>
          <select id="editar-supervisor" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
            <option value="Juan Pérez">Juan Pérez</option>
            <option value="María García">María García</option>
            <option value="Carlos López">Carlos López</option>
            <option value="Ana Rodríguez">Ana Rodríguez</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="editar-persona" class="block text-sm font-medium text-gray-700 mb-1">Persona que entrega</label>
          <input type="text" id="editar-persona" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
        
        <div class="flex justify-end space-x-3 mt-4">
          <button type="button" id="cancelar-edicion" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
            Cancelar
          </button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
            Guardar cambios
          </button>
        </div>
      </form>
    </div>
  </div>

  <script id="app-script">
    // Archivo de conexión a Supabase
    const supabaseConfig = {
      url: 'https://lwdapqzcrezgfkhgftac.supabase.co',
      anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3ZGFwcXpjcmV6Z2ZmaGdmdGFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5MTg0MzYsImV4cCI6MjA2NzQ5NDQzNn0.7X8mYgIVUTvaQXS5UE2gdlogolPQQmcOqzgaVemCI7k',
      initSupabase: function() {
        console.log('Inicializando conexión con Supabase...');
        // Aquí se inicializaría la conexión real con Supabase
        return {
          from: function(table) {
            return {
              select: function() {
                return this;
              },
              insert: function(data) {
                return {
                  then: function(callback) {
                    setTimeout(() => {
                      callback({ data: [{ id: Date.now(), ...data }], error: null });
                    }, 500);
                  }
                };
              },
              update: function(data) {
                return {
                  eq: function(field, value) {
                    return {
                      then: function(callback) {
                        setTimeout(() => {
                          callback({ data: [{ id: value, ...data }], error: null });
                        }, 500);
                      }
                    };
                  }
                };
              },
              delete: function() {
                return {
                  eq: function(field, value) {
                    return {
                      then: function(callback) {
                        setTimeout(() => {
                          callback({ data: [], error: null });
                        }, 500);
                      }
                    };
                  }
                };
              }
            };
          },
          storage: {
            from: function(bucket) {
              return {
                upload: function(path, file) {
                  return new Promise((resolve) => {
                    setTimeout(() => {
                      resolve({ data: { path: path }, error: null });
                    }, 1000);
                  });
                }
              };
            }
          }
        };
      }
    };

    // Mock data para el prototipo
    const mockData = {
      inventory: [
        { id: 1, numero_parte: 'ACC-001', descripcion: 'Bolsa deportiva grande', ubicacion: 'Jaula A-1', cantidad: 25, imagen: 'https://cdn.pixabay.com/photo/2017/08/02/01/34/pocket-2569181_960_720.jpg' },
        { id: 2, numero_parte: 'ACC-002', descripcion: 'Gorra ajustable', ubicacion: 'Jaula B-3', cantidad: 50, imagen: 'https://cdn.pixabay.com/photo/2016/11/19/15/43/baseball-cap-1839731_960_720.jpg' },
        { id: 3, numero_parte: 'ACC-003', descripcion: 'Guantes deportivos talla M', ubicacion: 'Jaula A-2', cantidad: 30, imagen: 'https://cdn.pixabay.com/photo/2017/08/06/00/27/gym-2587064_960_720.jpg' },
        { id: 4, numero_parte: 'ACC-004', descripcion: 'Pelota de fútbol', ubicacion: 'Jaula C-1', cantidad: 15, imagen: 'https://cdn.pixabay.com/photo/2014/05/03/00/46/soccer-ball-336772_960_720.jpg' },
        { id: 5, numero_parte: 'ACC-005', descripcion: 'Kit de entrenamiento básico', ubicacion: 'Jaula D-2', cantidad: 10, imagen: 'https://cdn.pixabay.com/photo/2017/07/02/19/24/dumbbells-2465478_960_720.jpg' }
      ],
      salidas: [
        { id: 1, accesorio_id: 1, tipo_accesorio: 'bolsa', cantidad: 5, celda_destino: 'Celda-123', supervisor: 'Juan Pérez', persona: 'María López', fecha_salida: '2025-03-15' },
        { id: 2, accesorio_id: 2, tipo_accesorio: 'gorra', cantidad: 10, celda_destino: 'Celda-456', supervisor: 'María García', persona: 'Pedro Sánchez', fecha_salida: '2025-03-16' },
        { id: 3, accesorio_id: 3, tipo_accesorio: 'guantes', cantidad: 8, celda_destino: 'Celda-789', supervisor: 'Carlos López', persona: 'Ana Torres', fecha_salida: '2025-03-17' }
      ]
    };

    // Inicializar la conexión a Supabase
    const supabase = supabaseConfig.initSupabase();

    document.addEventListener('DOMContentLoaded', function() {
      // Configuración de la fecha actual para los campos de fecha
      const today = new Date().toISOString().substr(0, 10);
      document.getElementById('fecha-entrada').value = today;
      document.getElementById('fecha-salida').value = today;
      
      // Manejo de pestañas
      const tabLinks = document.querySelectorAll('.tab-link');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const tabId = this.getAttribute('data-tab');
          
          // Actualizar clases activas
          tabLinks.forEach(el => el.classList.remove('active', 'text-blue-600', 'border-blue-600'));
          tabContents.forEach(el => el.classList.remove('active'));
          
          this.classList.add('active', 'text-blue-600', 'border-blue-600');
          document.getElementById(`${tabId}-tab`).classList.add('active');
          
          // Guardar pestaña activa en localStorage
          localStorage.setItem('activeTab', tabId);
          
          // Cargar datos según la pestaña
          if (tabId === 'stock') {
            loadInventory();
          } else if (tabId === 'entrega') {
            loadAccesorios();
            loadSalidas();
          }
        });
      });
      
      // Cargar pestaña guardada o por defecto
      const savedTab = localStorage.getItem('activeTab');
      if (savedTab) {
        document.querySelector(`.tab-link[data-tab="${savedTab}"]`).click();
      }
      
      // Vista previa de imágenes
      const imageInput = document.getElementById('imagenes');
      const previewContainer = document.getElementById('image-preview-container');
      
      imageInput.addEventListener('change', function() {
        previewContainer.innerHTML = '';
        
        if (this.files) {
          Array.from(this.files).forEach(file => {
            if (!file.type.match('image.*')) {
              return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
              const img = document.createElement('img');
              img.src = e.target.result;
              img.classList.add('image-preview');
              previewContainer.appendChild(img);
            };
            reader.readAsDataURL(file);
          });
        }
      });
      
      // Formulario de entrada de inventario
      const entradaForm = document.getElementById('entrada-form');
      entradaForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const numeroParte = document.getElementById('numero-parte').value;
        const fechaEntrada = document.getElementById('fecha-entrada').value;
        const descripcion = document.getElementById('descripcion').value;
        const ubicacion = document.getElementById('ubicacion').value;
        const cantidad = parseInt(document.getElementById('cantidad').value);
        const imagenes = document.getElementById('imagenes').files;
        
        // Validación
        if (!numeroParte || !fechaEntrada || !descripcion || !ubicacion || !cantidad) {
          showToast('Por favor complete todos los campos obligatorios.', 'error');
          return;
        }
        
        // Simular carga
        const saveButton = document.getElementById('guardar-entrada');
        saveButton.disabled = true;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Guardando...';
        
        // Subir imágenes (simulado)
        let imagePath = null;
        if (imagenes.length > 0) {
          const file = imagenes[0];
          const filePath = `inventory/${Date.now()}_${file.name}`;
          
          supabase.storage.from('accesorios').upload(filePath, file)
            .then(({ data, error }) => {
              if (error) {
                showToast('Error al subir la imagen.', 'error');
                return;
              }
              
              imagePath = data.path;
              saveInventoryItem();
            });
        } else {
          saveInventoryItem();
        }
        
        function saveInventoryItem() {
          const inventoryItem = {
            numero_parte: numeroParte,
            fecha_entrada: fechaEntrada,
            descripcion: descripcion,
            ubicacion: ubicacion,
            cantidad: cantidad,
            imagen: imagePath
          };
          
          supabase.from('inventario').insert(inventoryItem)
            .then(({ data, error }) => {
              saveButton.disabled = false;
              saveButton.innerHTML = '<i class="fas fa-save mr-2"></i> Guardar';
              
              if (error) {
                showToast('Error al guardar el inventario.', 'error');
                return;
              }
              
              // Éxito
              entradaForm.reset();
              document.getElementById('fecha-entrada').value = today;
              previewContainer.innerHTML = '';
              showToast('Entrada de inventario registrada con éxito.', 'success');
              
              // Actualizar lista si estamos en esa pestaña
              if (document.getElementById('stock-tab').classList.contains('active')) {
                loadInventory();
              }
            });
        }
      });
      
      // Cargar inventario para la pestaña de Stock
      function loadInventory() {
        const stockItems = document.getElementById('stock-items');
        stockItems.innerHTML = '<tr><td colspan="5" class="py-4 px-4 text-center text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i> Cargando inventario...</td></tr>';
        
        // Simulamos carga de datos
        setTimeout(() => {
          stockItems.innerHTML = '';
          
          if (mockData.inventory.length === 0) {
            stockItems.innerHTML = '<tr><td colspan="5" class="py-4 px-4 text-center text-gray-500">No hay elementos en el inventario.</td></tr>';
            return;
          }
          
          mockData.inventory.forEach(item => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            row.innerHTML = `
              <td class="py-2 px-4 border-b">${item.numero_parte}</td>
              <td class="py-2 px-4 border-b">${item.descripcion}</td>
              <td class="py-2 px-4 border-b">${item.ubicacion}</td>
              <td class="py-2 px-4 border-b text-right">${item.cantidad}</td>
              <td class="py-2 px-4 border-b text-center">
                ${item.imagen ? `<img src="${item.imagen}" alt="Miniatura" class="thumbnail mx-auto">` : 'Sin imagen'}
              </td>
            `;
            stockItems.appendChild(row);
          });
          
          // Actualizar información de paginación
          document.getElementById('items-showing').textContent = mockData.inventory.length;
          document.getElementById('items-total').textContent = mockData.inventory.length;
          document.getElementById('current-page').textContent = '1';
          document.getElementById('total-pages').textContent = '1';
        }, 500);
      }
      
      // Exportar inventario a Excel
      document.getElementById('exportar-excel').addEventListener('click', function() {
        // Simulación de exportación
        showToast('Exportando inventario a Excel...', 'success');
        setTimeout(() => {
          showToast('Exportación completada.', 'success');
        }, 1500);
      });
      
      // Exportar inventario a PDF
      document.getElementById('exportar-pdf').addEventListener('click', function() {
        // Simulación de exportación
        showToast('Exportando inventario a PDF...', 'success');
        setTimeout(() => {
          showToast('Exportación completada.', 'success');
        }, 1500);
      });
      
      // Cargar accesorios para el dropdown de entregas
      function loadAccesorios() {
        const accesorioDropdown = document.getElementById('accesorio-id');
        accesorioDropdown.innerHTML = '<option value="">Seleccione un accesorio</option>';
        
        mockData.inventory.forEach(item => {
          const option = document.createElement('option');
          option.value = item.id;
          option.textContent = `${item.numero_parte} - ${item.descripcion} (${item.cantidad} disponibles)`;
          accesorioDropdown.appendChild(option);
        });
      }
      
      // Cargar salidas para la tabla de historial
      function loadSalidas() {
        const salidasItems = document.getElementById('salidas-items');
        salidasItems.innerHTML = '<tr><td colspan="7" class="py-4 px-4 text-center text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i> Cargando salidas...</td></tr>';
        
        // Simulamos carga de datos
        setTimeout(() => {
          salidasItems.innerHTML = '';
          
          if (mockData.salidas.length === 0) {
            salidasItems.innerHTML = '<tr><td colspan="7" class="py-4 px-4 text-center text-gray-500">No hay registros de salidas.</td></tr>';
            return;
          }
          
          mockData.salidas.forEach(item => {
            const accesorio = mockData.inventory.find(inv => inv.id === item.accesorio_id) || { numero_parte: 'Desconocido' };
            
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            row.innerHTML = `
              <td class="py-2 px-4 border-b">${item.id}</td>
              <td class="py-2 px-4 border-b">${accesorio.numero_parte}</td>
              <td class="py-2 px-4 border-b text-right">${item.cantidad}</td>
              <td class="py-2 px-4 border-b">${item.fecha_salida}</td>
              <td class="py-2 px-4 border-b">${item.supervisor}</td>
              <td class="py-2 px-4 border-b">${item.persona}</td>
              <td class="py-2 px-4 border-b text-center">
                <button class="text-blue-600 hover:text-blue-800 mx-1 editar-salida" data-id="${item.id}">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="text-red-600 hover:text-red-800 mx-1 eliminar-salida" data-id="${item.id}">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </td>
            `;
            salidasItems.appendChild(row);
          });
          
          // Añadir event listeners para botones de editar y eliminar
          document.querySelectorAll('.editar-salida').forEach(btn => {
            btn.addEventListener('click', function() {
              const salidaId = parseInt(this.getAttribute('data-id'));
              openEditModal(salidaId);
            });
          });
          
          document.querySelectorAll('.eliminar-salida').forEach(btn => {
            btn.addEventListener('click', function() {
              const salidaId = parseInt(this.getAttribute('data-id'));
              confirmDeleteSalida(salidaId);
            });
          });
          
          // Actualizar información de paginación
          document.getElementById('salidas-showing').textContent = mockData.salidas.length;
          document.getElementById('salidas-total').textContent = mockData.salidas.length;
          document.getElementById('current-page-salidas').textContent = '1';
          document.getElementById('total-pages-salidas').textContent = '1';
        }, 500);
      }
      
      // Formulario de registro de salida
      const entregaForm = document.getElementById('entrega-form');
      entregaForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const accesorioId = document.getElementById('accesorio-id').value;
        const tipoAccesorio = document.getElementById('tipo-accesorio').value;
        const cantidadSalida = parseInt(document.getElementById('cantidad-salida').value);
        const celdaDestino = document.getElementById('celda-destino').value;
        const supervisor = document.getElementById('supervisor').value;
        const personaEntrega = document.getElementById('persona-entrega').value;
        const fechaSalida = document.getElementById('fecha-salida').value;
        
        // Validación
        if (!accesorioId || !tipoAccesorio || !cantidadSalida || !celdaDestino || !supervisor || !personaEntrega || !fechaSalida) {
          showToast('Por favor complete todos los campos obligatorios.', 'error');
          return;
        }
        
        // Verificar stock disponible
        const accesorio = mockData.inventory.find(item => item.id === parseInt(accesorioId));
        if (!accesorio || accesorio.cantidad < cantidadSalida) {
          showToast('No hay suficiente stock disponible.', 'error');
          return;
        }
        
        // Simular carga
        const saveButton = document.getElementById('registrar-salida');
        saveButton.disabled = true;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Registrando...';
        
        const salidaItem = {
          accesorio_id: parseInt(accesorioId),
          tipo_accesorio: tipoAccesorio,
          cantidad: cantidadSalida,
          celda_destino: celdaDestino,
          supervisor: supervisor,
          persona: personaEntrega,
          fecha_salida: fechaSalida
        };
        
        // Simulación de registro de salida
        setTimeout(() => {
          // Añadir a las salidas mockeadas
          const newId = mockData.salidas.length > 0 ? Math.max(...mockData.salidas.map(s => s.id)) + 1 : 1;
          mockData.salidas.push({ id: newId, ...salidaItem });
          
          // Actualizar stock
          accesorio.cantidad -= cantidadSalida;
          
          saveButton.disabled = false;
          saveButton.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Registrar Salida';
          
          // Éxito
          entregaForm.reset();
          document.getElementById('fecha-salida').value = today;
          showToast('Salida de accesorios registrada con éxito.', 'success');
          
          // Recargar datos
          loadAccesorios();
          loadSalidas();
        }, 800);
      });
      
      // Abrir modal de edición
      function openEditModal(salidaId) {
        const salida = mockData.salidas.find(s => s.id === salidaId);
        if (!salida) return;
        
        document.getElementById('editar-id').value = salida.id;
        document.getElementById('editar-cantidad').value = salida.cantidad;
        document.getElementById('editar-supervisor').value = salida.supervisor;
        document.getElementById('editar-persona').value = salida.persona;
        
        document.getElementById('modal-editar').classList.remove('hidden');
      }
      
      // Cerrar modal
      document.getElementById('cerrar-modal').addEventListener('click', function() {
        document.getElementById('modal-editar').classList.add('hidden');
      });
      
      document.getElementById('cancelar-edicion').addEventListener('click', function() {
        document.getElementById('modal-editar').classList.add('hidden');
      });
      
      // Guardar edición
      document.getElementById('editar-salida-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const id = parseInt(document.getElementById('editar-id').value);
        const nuevaCantidad = parseInt(document.getElementById('editar-cantidad').value);
        const nuevoSupervisor = document.getElementById('editar-supervisor').value;
        const nuevaPersona = document.getElementById('editar-persona').value;
        
        // Actualizar en mock data
        const salidaIndex = mockData.salidas.findIndex(s => s.id === id);
        if (salidaIndex !== -1) {
          const cantidadAnterior = mockData.salidas[salidaIndex].cantidad;
          const accesorioId = mockData.salidas[salidaIndex].accesorio_id;
          const accesorio = mockData.inventory.find(item => item.id === accesorioId);
          
          // Ajustar inventario (devolver cantidad anterior y restar nueva cantidad)
          if (accesorio) {
            accesorio.cantidad += cantidadAnterior - nuevaCantidad;
          }
          
          // Actualizar salida
          mockData.salidas[salidaIndex].cantidad = nuevaCantidad;
          mockData.salidas[salidaIndex].supervisor = nuevoSupervisor;
          mockData.salidas[salidaIndex].persona = nuevaPersona;
          
          showToast('Salida actualizada correctamente.', 'success');
          document.getElementById('modal-editar').classList.add('hidden');
          loadSalidas();
          loadAccesorios();
        }
      });
      
      // Confirmar eliminación de salida
      function confirmDeleteSalida(salidaId) {
        Swal.fire({
          title: '¿Estás seguro?',
          text: "Esta acción no se puede revertir",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          confirmButtonText: 'Sí, eliminar',
          cancelButtonText: 'Cancelar'
        }).then((result) => {
          if (result.isConfirmed) {
            deleteSalida(salidaId);
          }
        });
      }
      
      // Eliminar salida
      function deleteSalida(salidaId) {
        const salidaIndex = mockData.salidas.findIndex(s => s.id === salidaId);
        if (salidaIndex !== -1) {
          const salida = mockData.salidas[salidaIndex];
          const accesorio = mockData.inventory.find(item => item.id === salida.accesorio_id);
          
          // Devolver cantidades al inventario
          if (accesorio) {
            accesorio.cantidad += salida.cantidad;
          }
          
          // Eliminar salida
          mockData.salidas.splice(salidaIndex, 1);
          
          showToast('Salida eliminada correctamente.', 'success');
          loadSalidas();
          loadAccesorios();
        }
      }
      
      // Filtros de stock
      document.getElementById('aplicar-filtros').addEventListener('click', function() {
        // Simulación de filtrado
        showToast('Filtros aplicados.', 'success');
        
        // Guardar filtros en localStorage
        const filtros = {
          parte: document.getElementById('filtro-parte').value,
          descripcion: document.getElementById('filtro-descripcion').value,
          ubicacion: document.getElementById('filtro-ubicacion').value
        };
        localStorage.setItem('filtrosStock', JSON.stringify(filtros));
      });
      
      document.getElementById('limpiar-filtros').addEventListener('click', function() {
        document.getElementById('filtro-parte').value = '';
        document.getElementById('filtro-descripcion').value = '';
        document.getElementById('filtro-ubicacion').value = '';
        
        localStorage.removeItem('filtrosStock');
        showToast('Filtros limpiados.', 'success');
      });
      
      // Filtros de salidas
      document.getElementById('aplicar-filtros-salidas').addEventListener('click', function() {
        // Simulación de filtrado
        showToast('Filtros aplicados.', 'success');
        
        // Guardar filtros en localStorage
        const filtros = {
          fecha: document.getElementById('filtro-fecha').value,
          supervisor: document.getElementById('filtro-supervisor').value,
          celda: document.getElementById('filtro-celda').value
        };
        localStorage.setItem('filtrosSalidas', JSON.stringify(filtros));
      });
      
      document.getElementById('limpiar-filtros-salidas').addEventListener('click', function() {
        document.getElementById('filtro-fecha').value = '';
        document.getElementById('filtro-supervisor').value = '';
        document.getElementById('filtro-celda').value = '';
        
        localStorage.removeItem('filtrosSalidas');
        showToast('Filtros limpiados.', 'success');
      });
      
      // Restaurar filtros guardados
      const savedStockFilters = localStorage.getItem('filtrosStock');
      if (savedStockFilters) {
        const filtros = JSON.parse(savedStockFilters);
        document.getElementById('filtro-parte').value = filtros.parte || '';
        document.getElementById('filtro-descripcion').value = filtros.descripcion || '';
        document.getElementById('filtro-ubicacion').value = filtros.ubicacion || '';
      }
      
      const savedSalidasFilters = localStorage.getItem('filtrosSalidas');
      if (savedSalidasFilters) {
        const filtros = JSON.parse(savedSalidasFilters);
        document.getElementById('filtro-fecha').value = filtros.fecha || '';
        document.getElementById('filtro-supervisor').value = filtros.supervisor || '';
        document.getElementById('filtro-celda').value = filtros.celda || '';
      }
      
      // Exportar salidas a Excel
      document.getElementById('exportar-excel-salidas').addEventListener('click', function() {
        // Simulación de exportación
        showToast('Exportando salidas a Excel...', 'success');
        setTimeout(() => {
          showToast('Exportación completada.', 'success');
        }, 1500);
      });
      
      // Exportar salidas a PDF
      document.getElementById('exportar-pdf-salidas').addEventListener('click', function() {
        // Simulación de exportación
        showToast('Exportando salidas a PDF...', 'success');
        setTimeout(() => {
          showToast('Exportación completada.', 'success');
        }, 1500);
      });
      
      // Función para mostrar toast
      function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        
        toast.className = `toast toast-${type}`;
        toastMessage.textContent = message;
        
        toast.classList.add('show');
        
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
      }
      
      // Cargar datos iniciales
      loadInventory();
    });
  </script>
</body>
</html>
